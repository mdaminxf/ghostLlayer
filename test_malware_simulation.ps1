# Test Malware Simulation Script
# This script simulates various malware behaviors to test Ghost Layer detection

Write-Host "=== Ghost Layer Malware Detection Test ===" -ForegroundColor Green
Write-Host "Creating simulated malware files and processes..." -ForegroundColor Yellow

# Create test directory
$testDir = "C:\Ghost_Secrets\malware_test"
if (!(Test-Path $testDir)) {
    New-Item -ItemType Directory -Path $testDir -Force
}

# Test 1: Create a high-entropy file (simulates packed malware)
Write-Host "`n1. Creating high-entropy file (packed malware simulation)..." -ForegroundColor Cyan
$randomBytes = [System.Random]::new().NextBytes(1024)
$entropyFile = "$testDir\packed_malware.bin"
[System.IO.File]::WriteAllBytes($entropyFile, $randomBytes)

# Test 2: Create suspicious process names
Write-Host "2. Creating processes with suspicious names..." -ForegroundColor Cyan

# Simulate keylogger
$keyloggerProcess = Start-Process -FilePath "powershell" -ArgumentList "-Command", "Start-Sleep -Seconds 30; Write-Host 'Keylogger simulation'" -PassThru
$keyloggerProcess.ProcessName = "keylogger_simulation"

# Simulate ransomware
$ransomwareProcess = Start-Process -FilePath "powershell" -ArgumentList "-Command", "Start-Sleep -Seconds 30; Write-Host 'Ransomware simulation'" -PassThru
$ransomwareProcess.ProcessName = "cryptolocker_malware"

# Simulate backdoor
$backdoorProcess = Start-Process -FilePath "powershell" -ArgumentList "-Command", "Start-Sleep -Seconds 30; Write-Host 'Backdoor simulation'" -PassThru
$backdoorProcess.ProcessName = "backdoor_trojan"

# Simulate mining malware
$minerProcess = Start-Process -FilePath "powershell" -ArgumentList "-Command", "Start-Sleep -Seconds 30; Write-Host 'Crypto miner simulation'" -PassThru
$minerProcess.ProcessName = "crypto_miner_bot"

# Test 3: Create files with suspicious names
Write-Host "3. Creating files with suspicious names..." -ForegroundColor Cyan

$suspiciousFiles = @(
    "$testDir\mimikatz.exe",
    "$testDir\psexec.exe", 
    "$testDir\meterpreter.exe",
    "$testDir\cobaltstrike.exe",
    "$testDir\virus_payload.exe",
    "$testDir\trojan_dropper.exe",
    "$testDir\ransomware_decryptor.exe"
)

foreach ($file in $suspiciousFiles) {
    # Create dummy executable files
    $dummyContent = [System.Text.Encoding]::ASCII.GetBytes("MZ") + [System.Random]::new().NextBytes(1000)
    [System.IO.File]::WriteAllBytes($file, $dummyContent)
    Write-Host "Created: $file" -ForegroundColor Gray
}

# Test 4: Simulate RCE attack (browser spawning shell)
Write-Host "4. Simulating RCE attack pattern..." -ForegroundColor Cyan

# This simulates a browser spawning PowerShell (classic RCE pattern)
$rceProcess = Start-Process -FilePath "powershell" -ArgumentList "-Command", "Write-Host 'Simulated RCE from browser'; Start-Sleep -Seconds 20" -PassThru

# Test 5: Create process with random name (should be flagged)
Write-Host "5. Creating process with random name..." -ForegroundColor Cyan
$randomName = -join ((65..90) + (97..122) | Get-Random -Count 12 | ForEach-Object {[char]$_})
$randomProcess = Start-Process -FilePath "powershell" -ArgumentList "-Command", "Start-Sleep -Seconds 25; Write-Host 'Random name process'" -PassThru

Write-Host "`n=== Test Files Created ===" -ForegroundColor Green
Write-Host "Test directory: $testDir" -ForegroundColor White
Write-Host "Suspicious processes started:" -ForegroundColor White
Write-Host "  - Keylogger simulation" -ForegroundColor Yellow
Write-Host "  - Ransomware simulation" -ForegroundColor Yellow  
Write-Host "  - Backdoor simulation" -ForegroundColor Yellow
Write-Host "  - Crypto miner simulation" -ForegroundColor Yellow
Write-Host "  - RCE attack simulation" -ForegroundColor Yellow
Write-Host "  - Random name process" -ForegroundColor Yellow

Write-Host "`n=== Monitoring Ghost Layer Detection ===" -ForegroundColor Green
Write-Host "Check the Ghost Layer dashboard for detected threats!" -ForegroundColor Cyan
Write-Host "Expected detections:" -ForegroundColor White
Write-Host "  - High entropy file alert" -ForegroundColor Yellow
Write-Host "  - Suspicious process names" -ForegroundColor Yellow
Write-Host "  - RCE attack attempt" -ForegroundColor Yellow
Write-Host "  - Random process name" -ForegroundColor Yellow

# Wait a bit for detection
Start-Sleep -Seconds 5

Write-Host "`nTest complete! Check Ghost Layer dashboard for results." -ForegroundColor Green
Write-Host "Press any key to continue..."
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
