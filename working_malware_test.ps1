# Working Malware Detection Test
Write-Host "========================================" -ForegroundColor Red
Write-Host "  WORKING MALWARE DETECTION TEST" -ForegroundColor Red
Write-Host "========================================" -ForegroundColor Red

Write-Host "`n[TEST 1] Creating suspicious process names..." -ForegroundColor Cyan

# Create suspicious batch files
$suspiciousBatch1 = @'
@echo off
echo temp_malware.exe is running
timeout /t 5 /nobreak >nul
'@
$suspiciousBatch1 | Out-File -FilePath "temp_malware.bat" -Encoding ASCII

$suspiciousBatch2 = @'
@echo off
echo crypt_locker.exe is running
timeout /t 5 /nobreak >nul
'@
$suspiciousBatch2 | Out-File -FilePath "crypt_locker.bat" -Encoding ASCII

$suspiciousBatch3 = @'
@echo off
echo backdoor_trojan.exe is running
timeout /t 5 /nobreak >nul
'@
$suspiciousBatch3 | Out-File -FilePath "backdoor_trojan.bat" -Encoding ASCII

# Start suspicious processes
Write-Host "Starting temp_malware.bat..." -ForegroundColor Yellow
Start-Process -FilePath "cmd.exe" -ArgumentList "/c", "temp_malware.bat" -WindowStyle Hidden

Write-Host "Starting crypt_locker.bat..." -ForegroundColor Yellow
Start-Process -FilePath "cmd.exe" -ArgumentList "/c", "crypt_locker.bat" -WindowStyle Hidden

Write-Host "Starting backdoor_trojan.bat..." -ForegroundColor Yellow
Start-Process -FilePath "cmd.exe" -ArgumentList "/c", "backdoor_trojan.bat" -WindowStyle Hidden

Write-Host "`n[TEST 2] Browser exploit simulation..." -ForegroundColor Cyan
# Simulate browser spawning PowerShell
Write-Host "Simulating browser spawning PowerShell..." -ForegroundColor Yellow
Start-Process -FilePath "powershell.exe" -ArgumentList "-Command", "Write-Host 'exploit_payload.exe running from browser'; Start-Sleep -Seconds 5" -WindowStyle Hidden

Write-Host "`n[TEST 3] Suspicious PowerShell commands..." -ForegroundColor Cyan
# Create suspicious PowerShell process
Write-Host "Creating suspicious PowerShell process..." -ForegroundColor Yellow
Start-Process -FilePath "powershell.exe" -ArgumentList "-Command", "Write-Host 'hack_tool.exe running'; Start-Sleep -Seconds 5" -WindowStyle Hidden

Write-Host "`n[WAITING] All suspicious processes launched..." -ForegroundColor Green
Write-Host "Check your Ghost Layer dashboard NOW!" -ForegroundColor Green
Write-Host "You should see MULTIPLE threat alerts:" -ForegroundColor Green
Write-Host "  - SUSPICIOUS_PROCESS_NAME (temp_malware, crypt_locker, backdoor_trojan)" -ForegroundColor White
Write-Host "  - RCE_EXPLOIT (if browser simulation works)" -ForegroundColor White
Write-Host "  - PROCESS_INJECTION (for suspicious PowerShell)" -ForegroundColor White

Write-Host "`nWaiting 10 seconds for detection..." -ForegroundColor Gray
Start-Sleep -Seconds 10

Write-Host "`n[CLEANUP] Removing test files..." -ForegroundColor Gray
Remove-Item -Path "temp_malware.bat" -Force -ErrorAction SilentlyContinue
Remove-Item -Path "crypt_locker.bat" -Force -ErrorAction SilentlyContinue
Remove-Item -Path "backdoor_trojan.bat" -Force -ErrorAction SilentlyContinue

# Kill any remaining suspicious processes
Get-Process | Where-Object {$_.ProcessName -like "*temp*" -or $_.ProcessName -like "*malware*" -or $_.ProcessName -like "*crypt*" -or $_.ProcessName -like "*backdoor*"} | Stop-Process -Force -ErrorAction SilentlyContinue

Write-Host "`n========================================" -ForegroundColor Red
Write-Host "  TEST COMPLETE" -ForegroundColor Red
Write-Host "========================================" -ForegroundColor Red

Write-Host "`nEXPECTED RESULTS:" -ForegroundColor Yellow
Write-Host "  + Multiple threat alerts should be visible" -ForegroundColor Green
Write-Host "  + Dashboard threat count should increase" -ForegroundColor Green
Write-Host "  + Each alert should have proper threat type" -ForegroundColor Green

Write-Host "`nIF NO THREATS DETECTED:" -ForegroundColor Red
Write-Host "  X Detection logic needs debugging" -ForegroundColor Red
Write-Host "  X Check RCE detector implementation" -ForegroundColor Red
